<div class="rounded-lg border bg-base-100 text-base-content shadow-sm">
  <div class="flex flex-col space-y-1.5 p-6">
    <h3 class="text-2xl font-semibold leading-none tracking-tight">Documents created recently</h3>
  </div>
  <div class="p-6 pt-0">
    <div class="space-y-3">
      <% @proposals.each do |proposal| %>
        <div class="flex items-center justify-between p-3 bg-base-200 rounded-lg hover:bg-base-300 transition-colors duration-200">
          <div class="flex items-center gap-3">
            <i data-lucide="file-text" class="lucide lucide-file-text h-5 w-5 text-primary"></i>
            <div>
              <div class="font-medium text-base"><%= proposal.title %></div>
              <div class="text-sm text-base-content/60"><%= proposal.created_at.strftime("%B %d, %Y %I:%M %p") %></div>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <span class="badge badge-primary bg-primary/10 text-primary border-primary/20 font-semibold px-3 py-1 rounded-full capitalize text-sm">
              <%= proposal.status %>
            </span>
            <div class="dropdown dropdown-end">
              <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
                <i data-lucide="ellipsis" class="lucide lucide-ellipsis h-4 w-4"></i>
              </div>
              <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box w-52 p-2 shadow-md border border-base-200">
                <li><label for="proposal-modal-<%= proposal.id %>" class="cursor-pointer">Details</label></li>
                <li><a>Edit</a></li>
                <li><a>Delete</a></li>
                <li><a>Download</a></li>
              </ul>
            </div>
          </div>
        </div>

        <input type="checkbox" id="proposal-modal-<%= proposal.id %>" class="modal-toggle" />
        <div class="modal" role="dialog">
          <div class="modal-box bg-base-100 p-6 max-w-3xl">
            <div class="flex justify-between items-center mb-6">
              <h3 class="text-2xl font-bold text-base-content"><%= proposal.title %></h3>
              <span class="badge badge-primary bg-primary/10 text-primary border-primary/20 font-semibold px-4 py-2 capitalize text-base">
                  <%= proposal.status %>
              </span>
            </div>
            <div class="space-y-4">
              <div class="flex items-center gap-4">

                <% if proposal.pdf_ur.present? %>
                  <a href="<%= proposal.pdf_ur %>" class="btn btn-primary btn-sm" target="_blank">
                    <i data-lucide="download" class="lucide lucide-download h-4 w-4"></i>
                    Download PDF
                  </a>
                <% end %>
              </div>
              <div class="bg-base-200 p-4 rounded-lg">
                <h4 class="text-lg font-semibold mb-2">Requirement</h4>
                <div class="prose text-base-content/80 max-w-none">
                  <%= simple_format(proposal.requirement) %>
                </div>
              </div>
              <div class="bg-base-200 p-4 rounded-lg">
                <h4 class="text-lg font-semibold mb-2">Details</h4>
                <div class="space-y-2 text-base-content/80">
                  <p><span class="font-medium">Lead:</span> <%= proposal.lead&.company&.name || 'N/A' %></p>
                  <p><span class="font-medium">Template Proposal:</span> <%= proposal.template_proposal&.name || 'N/A' %></p>
                  <p><span class="font-medium">Created:</span> <%= proposal.created_at.strftime("%B %d, %Y %I:%M %p") %></p>
                  <p><span class="font-medium">Updated:</span> <%= proposal.updated_at.strftime("%B %d, %Y %I:%M %p") %></p>
                </div>
              </div>
              <% if proposal.customized_proposal.present? %>
                <div class="bg-base-200 p-4 rounded-lg">
                  <h4 class="text-lg font-semibold mb-2">Customized Proposal</h4>
                  <div class="space-y-4">
                    <% custom_proposal = JSON.parse(proposal.customized_proposal) rescue {} %>
                    <h5 class="text-xl font-bold"><%= custom_proposal['title'] %></h5>
                    <% custom_proposal['content']&.each do |section| %>
                      <div class="prose text-base-content/80 max-w-none">
                        <h6 class="text-base font-semibold"><%= section['title'] %></h6>
                        <%= simple_format(section['content']) %>
                      </div>
                    <% end %>
                  </div>
                </div>
              <% end %>
            </div>
            <div class="modal-action mt-6">
              <label for="proposal-modal-<%= proposal.id %>" class="btn btn-neutral btn-sm">Close</label>
            </div>
          </div>
          <label class="modal-backdrop" for="proposal-modal-<%= proposal.id %>">Close</label>
        </div>
      <% end %>
    </div>
  </div>
</div>
