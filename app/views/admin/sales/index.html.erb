<div class="space-y-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex justify-between items-center w-full">
      <div>
        <h1 class="text-2xl font-bold tracking-tight">Sales Pipeline</h1>
        <p class="text-gray-600">Manage sales process and track progress</p>
      </div>
      <button class="btn bg-black text-white border-black" onclick="my_modal_2.showModal()">
        <i data-lucide="plus" class="size-5"></i>
        Add new lead
      </button>
      <dialog id="my_modal_2" class="modal modal-bottom sm:modal-middle">
        <div class="modal-box max-w-lg sm:max-w-[700px] bg-white shadow-2xl rounded-xl p-6 sm:p-8">
          <div class="flex flex-col space-y-1.5 text-center sm:text-left">
            <h2 class="text-lg font-semibold leading-none tracking-tight">Add New Lead</h2>
            <p class="text-sm text-gray-600">Enter details to create a new lead for the sales pipeline</p>
          </div>
          <div class="mt-4 space-y-6">
            <div data-controller="contacts">
              <%= form_with model: Lead.new, url: admin_sales_path, method: :post, class: "space-y-6" do |f| %>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <fieldset class="fieldset space-y-2">
                    <legend class="fieldset-legend py-0">Project Name</legend>
                    <%= f.text_field :project_name,
                        class: "input w-full validator",
                        required: true,
                        placeholder: "Enter project name" %>
                    <p class="validator-hint mt-0 text-xs text-red-500 hidden">Project Name is required</p>
                  </fieldset>

                  <fieldset class="fieldset space-y-2">
                    <legend class="fieldset-legend py-0">Companies</legend>
                    <%= f.select :company_id,
                        options_from_collection_for_select(@companies, :id, :name),
                        { prompt: "Select Company" },
                        class: "select w-full",
                        data: {
                          action: "change->contacts#updateContacts",
                          contacts_target: "companySelect"
                        } %>
                  </fieldset>

                  <fieldset class="fieldset space-y-2">
                    <legend class="fieldset-legend py-0">Contacts</legend>
                    <%= f.select :contact_id,
                        [],
                        { prompt: "Select Contact" },
                        class: "select w-full",
                        data: {
                          contacts_target: "contactSelect"
                        } %>
                  </fieldset>

                  <fieldset class="fieldset space-y-2">
                    <legend class="fieldset-legend py-0">Manager</legend>
                    <%= f.select :manager_id,
                        options_from_collection_for_select(
                          User.all,
                          :id,
                          ->(user) { "#{user.email} (#{user.roles.first&.name&.humanize&.downcase || 'No Role'})" }
                        ),
                        { prompt: "Select Manager" },
                        class: "select w-full validator",
                        required: true %>
                    <p class="validator-hint mt-0 text-xs text-red-500 hidden">Manager is required</p>
                  </fieldset>

                  <fieldset class="fieldset space-y-2 md:col-span-2">
                    <legend class="fieldset-legend py-0">Note</legend>
                    <%= f.text_area :note,
                        class: "textarea h-24 w-full",
                        placeholder: "Note..." %>
                  </fieldset>
                </div>

                <div class="flex justify-end gap-3 pt-4">
                  <button type="button" class="btn btn-outline" onclick="document.getElementById('my_modal_2').close()">
                    Cancel
                  </button>
                  <%= f.submit "Create", class: "btn bg-black text-white border-black" %>
                </div>
              <% end %>
            </div>
          </div>
        </div>
        <form method="dialog" class="modal-backdrop">
          <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
        </form>
      </dialog>
    </div>
  </div>
  <%= render 'admin/sales/kanban_pipeline' %>
  <%= render 'admin/sales/ai_suggestion' %>
</div>
