<div class="space-y-6">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div class="flex justify-between items-center w-full">
      <div>
        <h1 class="text-2xl font-bold tracking-tight">Sales Pipeline</h1>
        <p class="text-gray-600">Manage sales process and track progress</p>
      </div>
      <button class="btn bg-black text-white border-black" onclick="my_modal_2.showModal()">
        <i data-lucide="plus" class="size-5"></i>
        Add new lead
      </button>
      <dialog id="my_modal_2" class="modal">
          <div class="modal-box max-w-lg sm:max-w-[700px]">
            <div class="flex flex-col space-y-1.5 text-center sm:text-left">
              <h2 class="text-lg font-semibold leading-none tracking-tight">Add a Data Source to Crawl</h2>
              <p class="text-sm text-gray-600">Enter the URL or API endpoint to collect data about potential customers</p>
            </div>
            <div class="mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2
            focus-visible:ring-ring focus-visible:ring-offset-2 space-y-4 py-4">

              <div data-controller="contacts">
                <%= form_with url: admin_sales_path, method: :post do |f| %>
                  <div class="space-y-2">
                    <fieldset class="fieldset">
                      <legend class="fieldset-legend">Companies</legend>
                      <%= select_tag :company_id,
                          options_from_collection_for_select(@companies, :id, :name),
                          prompt: "Select Company",
                          class: "select w-full",
                          data: {
                            action: "change->contacts#updateContacts",
                            contacts_target: "companySelect"
                          } %>
                    </fieldset>
                  </div>

                  <div class="space-y-2">
                    <fieldset class="fieldset">
                      <legend class="fieldset-legend">Contacts</legend>
                      <select name="contact_id" class="select w-full" data-contacts-target="contactSelect">
                        <option>Select contact</option>
                      </select>
                    </fieldset>
                  </div>
                  <div class="space-y-2">
                    <fieldset class="fieldset">
                      <legend class="fieldset-legend">Manager</legend>
                      <%= f.select :manager_id,
                          options_from_collection_for_select(
                            User.all,
                            :id,
                            ->(user) { "#{user.email}(#{user.roles.first&.name&.humanize.downcase || 'No Role'})" }
                          ),
                          { prompt: "Select Manager" },
                          class: "select w-full validator", required: true
                      %>
                      <p class="validator-hint mt-0">Manager is required</p>
                    </fieldset>
                  </div>


                  <div class="space-y-2">
                    <fieldset class="fieldset">
                      <legend class="fieldset-legend">Note</legend>
                      <%= f.text_area :note, class: "textarea h-24 w-full", placeholder: "Note..." %>
                    </fieldset>
                  </div>

                  <div class="flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2 mt-2">
                    <%= f.submit "Create", class: "btn bg-black text-white border-black" %>
                  </div>

                <% end %>
              </div>

            </div>
          <form method="dialog" class="modal-backdrop">
            <button>close</button>
          </form>
      </dialog>
    </div>
  </div>
  <%= render 'admin/sales/kanban_pipeline' %>
</div>
